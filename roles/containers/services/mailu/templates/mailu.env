# Mailu main configuration file
#
# This file is autogenerated by the configuration management wizard for compose flavor.
# For a detailed list of configuration variables, see the documentation at
# https://mailu.io

###################################
# Common configuration variables
###################################

# Set to a randomly generated 16 bytes string
SECRET_KEY={{ mailu['secret_key'] }}

# Subnet of the docker network. This should not conflict with any networks to which your system is connected. (Internal and external!)
SUBNET={{ containers['subnet'] }}

# Main mail domain
DOMAIN={{ mailu['mail_domain'] }}

# Hostnames for this server, separated with comas
HOSTNAMES=mail.{{ server['network']['domain_name'] }}

# Postmaster local part (will append the main mail domain)
POSTMASTER={{ mailu['postmaster'] }}

# Choose how secure connections will behave (value: letsencrypt, cert, notls, mail, mail-letsencrypt)
TLS_FLAVOR=cert

# Authentication rate limit per IP (per /24 on ipv4 and /56 on ipv6)
AUTH_RATELIMIT_IP=5/hour

# Authentication rate limit per user (regardless of the source-IP)
AUTH_RATELIMIT_USER=50/day

# Opt-out of statistics, replace with "True" to opt out
DISABLE_STATISTICS=True

###################################
# Optional features
###################################

# Expose the admin interface (value: true, false)
ADMIN=true

# Choose which webmail to run if any (values: roundcube, rainloop, none)
{% if mailu['roundcube']['enabled'] is true %}
WEBMAIL=roundcube
{% else %}
WEBMAIL=none
{% endif %}

# Dav server implementation (value: radicale, none)
WEBDAV=none

# Expose the API interface (value: true, false)
{% if mailu['rest_api_enabled'] is true %}
API=true
{% else %}
API=false
{% endif %}

# Antivirus solution (value: clamav, none)
{% if mailu['clamav'] is true %}
ANTIVIRUS=clamav
{% else %}
ANTIVIRUS=none
{% endif %}

# Scan Macros solution (value: true, false)
SCAN_MACROS=false

###################################
# Mail settings
###################################

# Message size limit in bytes
# Default: accept messages up to 50MB
# Max attachment size will be 33% smaller
MESSAGE_SIZE_LIMIT=50000000

# Message rate limit (per user)
MESSAGE_RATELIMIT=200/day

# Networks granted relay permissions
# Use this with care, all hosts in this networks will be able to send mail without authentication!
RELAYNETS=

# Will relay all outgoing mails if configured
RELAYHOST=

# Enable fetchmail
{% if mailu['fetchmail'] is true %}
FETCHMAIL_ENABLED=True
{% else %}
FETCHMAIL_ENABLED=False
{% endif %}

# Fetchmail delay
FETCHMAIL_DELAY=600

# Recipient delimiter, character used to delimiter localpart from custom address part
RECIPIENT_DELIMITER=+

# DMARC rua and ruf email
DMARC_RUA={{ mailu['postmaster'] }}
DMARC_RUF={{ mailu['postmaster'] }}

# Welcome email, enable and set a topic and body if you wish to send welcome
# emails to all users.
WELCOME=false
WELCOME_SUBJECT=Welcome to your new email account
WELCOME_BODY=Welcome to your new email account, if you can read this, then it is configured properly!

# Maildir Compression
# choose compression-method, default: none (value: gz, bz2, lz4, zstd)
COMPRESSION=
# change compression-level, default: 6 (value: 1-9)
COMPRESSION_LEVEL=

# IMAP full-text search is enabled by default. Set the following variable to off in order to disable the feature.
# FULL_TEXT_SEARCH=off

###################################
# Web settings
###################################

# Path to redirect / to
WEBROOT_REDIRECT=/webmail

# Path to the admin interface if enabled
WEB_ADMIN=/admin

# Path to the webmail if enabled
WEB_WEBMAIL=/webmail

{% if mailu['rest_api_enabled'] is true %}
# Path to the API interface if enabled
WEB_API=/api

{% endif %}
# Website name
SITENAME={{ mailu['site_name'] }}

# Linked Website URL
WEBSITE=https://mail.{{ server['network']['domain_name'] }}

###################################
# Advanced settings
###################################

# Log driver for front service. Possible values:
# json-file (default)
# journald (On systemd platforms, useful for Fail2Ban integration)
# syslog (Non systemd platforms, Fail2Ban integration. Disables `docker-compose log` for front!)
# LOG_DRIVER=json-file

# Number of rounds used by the password hashing scheme
CREDENTIAL_ROUNDS=12

# Header to take the real ip from
REAL_IP_HEADER=

# choose wether mailu bounces (no) or rejects (yes) mail when recipient is unknown (value: yes, no)
REJECT_UNLISTED_RECIPIENT=

# Log level threshold in start.py (value: CRITICAL, ERROR, WARNING, INFO, DEBUG, NOTSET)
LOG_LEVEL=WARNING

# Timezone for the Mailu containers. See this link for all possible values https://en.wikipedia.org/wiki/List_of_tz_database_time_zones
TZ={{ server['timezone'] | default(ansible_date_time.tz) }}

# Default spam threshold used for new users
DEFAULT_SPAM_THRESHOLD=70
{% if mailu['rest_api_enabled'] is true %}
# API token required for authenticating to the RESTful API.
# This is a mandatory setting for using the RESTful API.
API_TOKEN={{ mailu['api_token'] }}

{% endif %}

###################################
# Database settings
###################################
SQLALCHEMY_DATABASE_URI=postgresql://{{ mailu['postgres_user'] }}:{{ mailu['postgres_password'] }}@postgres/{{ mailu['db_name'] }}
{% if mailu['roundcube']['enabled'] is true %}
SQLALCHEMY_DATABASE_URI_ROUNDCUBE=pgsql://{{ mailu['roundcube']['postgres_user'] }}:{{ mailu['roundcube']['postgres_password'] }}@postgres/{{ mailu['roundcube']['db_name'] }}
{% endif %}

{% if keycloak['enabled'] is true and
   nginx_proxy['certbot']['enabled'] is true
%}
###################################
# OIDC settings
###################################
OIDC_ENABLED=True
OIDC_PROVIDER_INFO_URL=https://accounts.{{ server['network']['domain_name'] }}/realms/{{ keycloak['realm_name'] }}/
OIDC_CLIENT_ID=mailu
OIDC_CLIENT_SECRET={{ mailu['OIDC']['client_secret'] }}
OIDC_BUTTON_NAME={{ mailu['OIDC']['button_name'] }}

{% endif %}
###################################
# Containers names and addresses settings
###################################
FRONT_ADDRESS=mail.{{ server['network']['domain_name'] }}
IMAP_ADDRESS=dovecot
SMTP_ADDRESS=postfix
ADMIN_ADDRESS=mailu-admin
ANTISPAM_ADDRESS=rspamd
REDIS_ADDRESS=redis
{% if mailu['clamav'] is true %}
ANTIVIRUS_ADDRESS=clamav
{% endif %}
{% if mailu['roundcube']['enabled'] is true %}
WEBMAIL_ADDRESS=roundcube
{% endif %}

SMTP_ADDRESS_OVERRIDE={{ containers['loopback_network_address'] }}:10150
AUTHSMTP_ADDRESS_OVERRIDE={{ containers['loopback_network_address'] }}:10151
IMAP_ADDRESS_OVERRIDE={{ containers['loopback_network_address'] }}:10152
POP3_ADDRESS_OVERRIDE={{ containers['loopback_network_address'] }}:10153
