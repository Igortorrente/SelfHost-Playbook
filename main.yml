---
- name: Main playbook.
  hosts: all

  vars_files:
    user_vars.yaml

  roles:
    - role: roles/playbook_vars/

    - role: roles/system/basic/

    - role: roles/system/vim
      when: optional_roles['vim']

    - role: roles/system/zsh
      when: optional_roles['zsh']

    - role: roles/system/wireguard
      when: admin_wireguard['enabled']

    - role: roles/system/container_setup/

    - role: roles/containers/infra/redis/

    - role: roles/containers/infra/postgres/
      when: keycloak['enabled']

    - role: roles/containers/infra/nginx
      when: >
        dns['enabled'] or
        homer['enabled'] or
        keycloak['enabled']

    - role: roles/containers/infra/bind9/
      when: dns['enabled']

    - role: roles/containers/services/homer
      when: homer['enabled']
